---
id: endpoint-malware-investigation---generic-v2
title: Endpoint Malware Investigation - Generic V2
description: The Endpoint Malware Investigation - Generic V2 playbook provides a framework for handling malware investigations.
---

The **Endpoint Malware Investigation - Generic V2** playbook is the main playbook and provides a framework for handling malware investigations. The playbook consists of the following 7 stages. Each stage contains the relevant sub-playbook or tasks. 
- [Enrichment](#enrichment)
- [Retrieve](#retrieve)
- [Detonation](#detonation)
- [Forensics](#forensics)
- [Threat Hunting](#threat-hunting)
- [Isolation](#Isolation)
- [Remediation and Blocking Indicators](#remediation-and-blocking-indicators)

### Enrichment

The **Endpoint Enrichment - Generic v2.1** playbook provides the initial details for the hosts involved in the incident. 

For additional information, refer to: https://xsoar.pan.dev/docs/reference/playbooks/endpoint-enrichment---generic-v21.

The **File Enrichment - Generic v2** playbook provides a preliminary verdict for the suspicious file. 

For additional information, refer to: https://xsoar.pan.dev/docs/reference/playbooks/file-enrichment---generic-v2File .

### Retrieve
The **Retrieve File from Endpoint - Generic V2** playbook retrieves the required file for further investigation. This playbook can retrieve a file by its hash or by its file path. 

For additional information, refer to: https://xsoar.pan.dev/docs/reference/playbooks/retrieve-file-from-endpoint---generic-v2.

### Detonation
Dynamic analysis for suspicious files is a significant stage in every malware incident. The analysis will not only determine if the file is malicious but also provide indicators for further investigation. The **Detonate File - Generic** playbook detonates files through active integrations that support file detonation. 

For additional information, refer to: https://xsoar.pan.dev/docs/reference/playbooks/detonate-file---generic

### Forensics
The **Forensics - Generic** playbook provides additional forensics on the investigated host. Currently, this playbook uses only the Illusive network integration.

For additional information, refer to:**LINK**

### Threat Hunting
The **Threat Hunting - Generic** playbook assists in hunting IOCs in your organization as part of the malware investigation. 


For additional information refer to:**LINK**

### Isolation
The **Isolate Endpoint - Generic** playbook rapidly isolates the infected host and prevents the threat from spreading out in your organization. 

For additional information, refer to: https://xsoar.pan.dev/docs/reference/playbooks/isolate-endpoint---generic

### Remediation and blocking indicators
The **Block Indicators - Generic v2** playbook blocks the malicious indicators that were discovered during the investigation. The playbook blocks files, IPs, email addresses, URLs, and user accounts. 

The **Unisolate Endpoint - Generic** playbook rapidly unisolates hosts that were acquitted in the investigation.


For additional information, refer to: https://xsoar.pan.dev/docs/reference/playbooks/block-indicators---generic-v2

## Classification and Mapping
(https://xsoar.pan.dev/docs/incidents/incident-classification-mapping)

To use the **Endpoint Malware Investigation - Generic V2** playbook we strongly recommend that you map the playbook for the relevant integration.
1. Navigate to **Settings** > **Integrations** > **Classification and Mapping**.
2. Select the relevant integration that you want to map.
3. Click **Duplicate**.

**Need link to Screen showing the Duplicate button**

4. Click the copy you just created. 
5. From the *Incident Type* dropdown list, select **Malware**.

**Need link to Screen showing the Incident Type dropdown list and choosing Malware**

6. From the *Select Instance* dropdown list, select the instance that you want to map (for example: ExpanseV2_instance_1 (ExpanseV2)).

**Need link to Screen showing the Select Instance dropdown list**

   After selecting your instance, the *Data fetched JSON* panel will be loaded.

**Need link to Screen showing the Data fetched JSON panel with info**

7. Map the relevant fields from the JSON by selecting the keys and clicking **Choose data path**. See the table in the [Auto Extract](#auto-extract) section for the fields to map. For information about creating a mapper, see (https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-1/cortex-xsoar-admin/incidents/classification-and-mapping/create-a-mapper.html).

**Need link to Screen showing the mapping in progress.**

8. Click **Save Version**.
9. Navigate to **Settings** > **Integration** > **Servers & Services**.
10. Access the relevant integration instance setting and edit it as follows:
   - From the Incident Type dropdown list, select **Malware**.
   - For the Mapper, select the mapper you created. 

   **Need link to Screen showing the mapping in progress.**

## Auto Extract 

The [Auto Extract](https://xsoar.pan.dev/docs/incidents/incident-auto-extract) feature extracts indicators from incidents fields and enriches their reputations using commands and scripts defined for the indicator type. 

In order for the malware incident type layout to properly display the relevant fields and for the playbooks to run properly it is important to map the fields as shown in the table below so that they will be presented in the malware incident layout.
Refer to the [incident classification and mapping](https://xsoar.pan.dev/docs/incidents/incident-classification-mapping) documentation for relevant guidance.


| File Attributes | Source Details |
| --------- | ------------- | 
| File Name | Src | 
| File Path | Host Name |
| File Hash | MAC Address | 
| MD5 | Src NT Domain | 
|  SHA1 | Src OS | 
| SHA256 | Agent ID | 
| File Size | Isolated | 
| Signature | | 

### Indicator Extraction Rules

In the **Endpoint Malware Investigation - Generic V2** playbook, the indicators are extracted according to the indicators extraction rules of the malware incident type.

#### View Indicator Extraction Rules

To view the indicators that will be extracted:
1. Navigate to **Settings** >  **Advanced** > **Incidents Types**.
2. Mark the *Malware* checkbox.
3. Click **Indicator Extraction Rules**.

**Need link to Screen showing the Indicator Extraction Rule.**

#### Edit Indicator Extraction Rules

If you want to edit the indicator extraction rules, you need to detach the Malware incident type. When you finish editing the rules, you must reattach the Malware incident type.
1. Navigate to **Settings** >  **Advanced** > **Incidents Types**.
2. Mark the *Malware* checkbox.
4. Click **Detach**.

**Need link to Screen showing the Detach button.**

2. Mark the *Malware* checkbox.
3. Click **Indicator Extraction Rules**.
5. Edit the rules.
6. When you are finished editing, click **Save**.
7. Mark the *Malware* checkbox.
8. Click **Reattach**.

Note: Reattaching the incident type enables getting updates for the incident type. When you reattach the incident type, the next update will override any changes you made to the default playbook and indicator extraction rules.

### Integrations

The following is a list of integrations each playbook/sub-playbook uses.

| Playbook | Integrations |
| ----- | ----- |
| Endpoint Enrichment - Generic v2.1 | - [Active Directory Query v2](https://xsoar.pan.dev/docs/reference/playbooks/endpoint-enrichment---generic-v21)<br/>- [McAfee ePolicy Orchestrator](https://xsoar.pan.dev/docs/reference/integrations/epo)<br/>- Carbon Black Enterprise Response v2<br/>- [Cylance Protect v2](https://xsoar.pan.dev/docs/reference/integrations/cylance-protect-v2)<br/>- [CrowdStrike Falcon](https://xsoar.pan.dev/docs/reference/integrations/crowdstrike-falcon)<br/>- ExtraHop Reveal(x) |
| File Enrichment - Generic v2 | - [Cylance Protect v2](https://xsoar.pan.dev/docs/reference/integrations/cylance-protect-v2)<br/>- [VirusTotal - Private API](https://xsoar.pan.dev/docs/reference/integrations/virus-total---private-api) |
| Retrieve File from Endpoint - Generic V2 | - [VMware Carbon Black EDR](https://xsoar.pan.dev/docs/reference/integrations/carbon-black-enterprise-edr)<br/>- [VMware Carbon Black EDR - Live Response API](https://xsoar.pan.dev/docs/reference/integrations/carbonblackliveresponse)<br/>- [Cylance Protect v2](https://xsoar.pan.dev/docs/reference/integrations/cylance-protect-v2) |
| **Detonate File - Generic** | - [Group-IB TDS Polygon](https://xsoar.pan.dev/docs/reference/integrations/group-ib-tds-polygon)<br/>- [JoeSecurity](https://xsoar.pan.dev/docs/reference/integrations/joe-security)<br/>- [McAfee Advanced Threat Defense](https://xsoar.pan.dev/docs/reference/integrations/mc-afee-advanced-threat-defense)<br/>- [Cisco Threat Grid](https://xsoar.pan.dev/docs/reference/integrations/threat-grid)<br/>- [CrowdStrike Falcon Sandbox](https://xsoar.pan.dev/docs/reference/integrations/vx-stream)<br/>- [Palo Alto Networks WildFire V2](https://xsoar.pan.dev/docs/reference/integrations/wild-fire-v2)<br/>- [Lastline v2](https://xsoar.pan.dev/docs/reference/integrations/lastline-v2)<br/>- [Cuckoo Sandbox](https://xsoar.pan.dev/docs/reference/integrations/cuckoo-sandbox)<br/>- [SNDBOX](https://xsoar.pan.dev/docs/reference/integrations/sndbox)<br/>- [Hybrid Analysis](https://xsoar.pan.dev/docs/reference/integrations/hybrid-analysis)<br/>- [ANY.RUN](https://xsoar.pan.dev/docs/reference/integrations/anyrun)<br/>- [FireEye (AX Series)](https://xsoar.pan.dev/docs/reference/integrations/fireeye)<br/>- [VMRay](https://xsoar.pan.dev/docs/reference/integrations/vmray)<br/>- [CrowdStrike Falcon X](https://xsoar.pan.dev/docs/reference/integrations/crowd-strike-falcon-x) |
|**Threat Hunting - Generic** | - [SplunkPY](https://xsoar.pan.dev/docs/reference/integrations/splunk-py)<br/>- [IBM Qradar](https://xsoar.pan.dev/docs/reference/integrations/q-radar) |
| **Isolate Endpoint - Generic** | - Carbon Black Response<br/>- [Palo Alto Networks Traps](https://xsoar.pan.dev/docs/reference/integrations/traps)<br/>- [Cybereason](https://xsoar.pan.dev/docs/reference/integrations/cybereason) <br/>- [CrowdStrike Falcon](https://xsoar.pan.dev/docs/reference/integrations/crowdstrike-falcon) |
| **Unisoloate Endpoint - Generic** | - Carbon Black Response<br/>- Cortex XDR<br/>- [CrowdStrike Falcon](https://xsoar.pan.dev/docs/reference/integrations/crowdstrike-falcon) |
| **Block Indicators - Generic v2** | - PAN-OS<br/>- [Minemeld](https://xsoar.pan.dev/docs/reference/integrations/palo-alto-minemeld)<br/>- Cortex XDR<br/>- [Cylance Protect v2](https://xsoar.pan.dev/docs/reference/integrations/cylance-protect-v2)<br/>- Carbon Black Response<br/>- [Palo Alto Networks Traps](https://xsoar.pan.dev/docs/reference/integrations/traps)<br/>- [Cybereason](https://xsoar.pan.dev/docs/reference/integrations/cybereason)<br/>- [Active Directory Query V2](https://xsoar.pan.dev/docs/reference/integrations/active-directory-query-v2)<br/>- [Checkpoint Firewall V2](https://xsoar.pan.dev/docs/reference/integrations/check-point-firewall-v2)<br/>- [Zscaler](https://xsoar.pan.dev/docs/reference/integrations/zscaler)<br/>- [FortiGate](https://xsoar.pan.dev/docs/reference/integrations/forti-gate)<br/>- [Symantec Messaging Gateway](https://xsoar.pan.dev/docs/reference/integrations/symantec-messaging-gateway)